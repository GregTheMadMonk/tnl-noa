#!/bin/bash

device="host"
dofSize=256
dimension=2;
proportions=2
finalTime=1.0e-1
timeStep=1.0e-5

analyticFunction="exp-bump"
sigma=1.0

tnl-grid-setup --dimensions ${dimension} \
               --proportions-x ${proportions} \
               --proportions-y ${proportions} \
               --proportions-z ${proportions} \
               --origin-x -1 \
               --origin-y -1 \
               --origin-z -1 \
               --size-x ${dofSize} \
               --size-y ${dofSize} \
               --size-z ${dofSize} \
               
tnl-init --mesh mesh.tnl \
         --test-function ${analyticFunction} \
         --output-file init.tnl \
         --sigma ${sigma}

#valgrind --tool=memcheck \
tnl-heat-equation --device ${device} \
                  --time-discretisation explicit \
                  --boundary-conditions-type neumann \
                  --boundary-conditions-constant 0 \
                  --discrete-solver euler \
                  --snapshot-period ${finalTime} \
                  --final-time ${finalTime} \
                  --time-step ${timeStep} \
                  --max-iterations 100000000 \
                  --refresh-rate 1000 \
                  --omp-enabled false

tnl-benchmark-heat-equation --device ${device} \
                  --time-discretisation explicit \
                  --boundary-conditions-type neumann \
                  --boundary-conditions-constant 0 \
                  --discrete-solver euler \
                  --snapshot-period ${finalTime} \
                  --final-time ${finalTime} \
                  --time-step ${timeStep} \
                  --max-iterations 100000000 \
                  --refresh-rate 1000 \
                  --omp-enabled false
              
tnl-benchmark-simple-heat-equation --device ${device} \
                                   --domain-x-size 2 \
                                   --domain-y-size 2 \
                                   --grid-x-size ${dofSize} \
                                   --grid-y-size ${dofSize} \
                                   --sigma ${sigma} \
                                   --time-step ${timeStep} \
                                   --final-time ${finalTime}       
                                   
tnl-diff --input-files simple-heat-equation-result.tnl u-00001.tnl

cat tnl-diff.log                                         
